"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[750],{750:(F,M,u)=>{u.r(M),u.d(M,{UserHomePageModule:()=>Z});var _=u(177),m=u(9417),s=u(4742),f=u(4964),d=u(467),e=u(4438),v=u(8860),h=u(4796);let p=(()=>{var i;class l{constructor(t,a,n){this.modalController=t,this.mascotaService=a,this.authService=n}dismiss(t){this.modalController.dismiss(t)}guardarCambios(){var t=this;return(0,d.A)(function*(){if(t.mascota&&t.mascota.id)try{const a=yield t.authService.getUserId();if(a){const n={...t.mascota,usuarioId:a};yield t.mascotaService.actualizarMascota(t.mascota.id,n),t.dismiss(n)}}catch(a){console.error("Error actualizando mascota:",a)}})()}}return(i=l).\u0275fac=function(t){return new(t||i)(e.rXU(s.W3),e.rXU(v.W),e.rXU(h.u))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-editar-mascota-modal"]],inputs:{mascota:"mascota"},decls:34,vars:5,consts:[["slot","end"],[3,"click"],[3,"ngSubmit"],["position","floating"],["name","nombre","required","",3,"ngModelChange","ngModel"],["name","especie","required","",3,"ngModelChange","ngModel"],["name","raza","required","",3,"ngModelChange","ngModel"],["type","number","name","edad","required","",3,"ngModelChange","ngModel"],["type","date","name","fechaNacimiento","required","",3,"ngModelChange","ngModel"],["expand","block",3,"click"]],template:function(t,a){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Editar Mascota"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return a.dismiss()}),e.EFF(6,"Cerrar"),e.k0s()()()(),e.j41(7,"ion-content")(8,"form",2),e.bIt("ngSubmit",function(){return a.guardarCambios()}),e.j41(9,"ion-item")(10,"ion-label",3),e.EFF(11,"Nombre"),e.k0s(),e.j41(12,"ion-input",4),e.mxI("ngModelChange",function(o){return e.DH7(a.mascota.nombre,o)||(a.mascota.nombre=o),o}),e.k0s()(),e.j41(13,"ion-item")(14,"ion-label",3),e.EFF(15,"Especie"),e.k0s(),e.j41(16,"ion-input",5),e.mxI("ngModelChange",function(o){return e.DH7(a.mascota.especie,o)||(a.mascota.especie=o),o}),e.k0s()(),e.j41(17,"ion-item")(18,"ion-label",3),e.EFF(19,"Raza"),e.k0s(),e.j41(20,"ion-input",6),e.mxI("ngModelChange",function(o){return e.DH7(a.mascota.raza,o)||(a.mascota.raza=o),o}),e.k0s()(),e.j41(21,"ion-item")(22,"ion-label",3),e.EFF(23,"Edad"),e.k0s(),e.j41(24,"ion-input",7),e.mxI("ngModelChange",function(o){return e.DH7(a.mascota.edad,o)||(a.mascota.edad=o),o}),e.k0s()(),e.j41(25,"ion-item")(26,"ion-label",3),e.EFF(27,"Fecha de Nacimiento"),e.k0s(),e.nrm(28,"br"),e.j41(29,"ion-input",8),e.mxI("ngModelChange",function(o){return e.DH7(a.mascota.fechaNacimiento,o)||(a.mascota.fechaNacimiento=o),o}),e.k0s()()()(),e.j41(30,"ion-footer")(31,"ion-toolbar")(32,"ion-button",9),e.bIt("click",function(){return a.guardarCambios()}),e.EFF(33,"Guardar Cambios"),e.k0s()()()),2&t&&(e.R7$(12),e.R50("ngModel",a.mascota.nombre),e.R7$(4),e.R50("ngModel",a.mascota.especie),e.R7$(4),e.R50("ngModel",a.mascota.raza),e.R7$(4),e.R50("ngModel",a.mascota.edad),e.R7$(5),e.R50("ngModel",a.mascota.fechaNacimiento))},dependencies:[m.qT,m.BC,m.cb,m.YS,m.vS,m.cV,s.Jm,s.QW,s.W9,s.M0,s.eU,s.$w,s.uz,s.he,s.BC,s.ai,s.su,s.Gw]}),l})();var C=u(6354),b=u(8079);let D=(()=>{var i;class l{constructor(t){this.firestore=t}getVeterinarios(){return this.firestore.collection("users",t=>t.where("role","==","veterinario")).valueChanges({idField:"id"}).pipe((0,C.T)(t=>t))}getVeterinarioById(t){return this.firestore.doc(`users/${t}`).valueChanges()}}return(i=l).\u0275fac=function(t){return new(t||i)(e.KVO(b.Qe))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),l})();var I=u(6898);function k(i,l){if(1&i&&(e.j41(0,"ion-select-option",12),e.EFF(1),e.k0s()),2&i){const r=l.$implicit;e.Y8G("value",r.id),e.R7$(),e.Lme(" ",r.nombre," - ",r.email," ")}}function j(i,l){if(1&i&&(e.j41(0,"ion-select-option",12),e.EFF(1),e.k0s()),2&i){const r=l.$implicit;e.Y8G("value",r.id),e.R7$(),e.Lme(" ",r.nombre," - ",r.especie," ")}}function S(i,l){if(1&i&&(e.j41(0,"ion-select-option",12),e.EFF(1),e.k0s()),2&i){const r=l.$implicit;e.Y8G("value",r),e.R7$(),e.SpI(" ",r," ")}}let y=(()=>{var i;class l{constructor(t,a,n,o,c){this.modalController=t,this.veterinarioService=a,this.citasService=n,this.mascotaService=o,this.authService=c,this.veterinarios=[],this.mascotas=[],this.horasDisponibles=[],this.citasExistentes=[],this.nuevaCita={veterinarioId:"",mascotaId:"",fecha:(new Date).toISOString(),hora:"",motivo:""},this.minDate=(new Date).toISOString(),this.maxDate=new Date,this.maxDate.setMonth(this.maxDate.getMonth()+3)}ngOnInit(){this.cargarDatos(),this.generarHorasDisponibles()}cargarDatos(){var t=this;return(0,d.A)(function*(){const a=yield t.authService.getUserId();a&&(t.mascotaService.obtenerMascotasPorUsuarioId(a).subscribe(n=>t.mascotas=n),t.veterinarioService.getVeterinarios().subscribe(n=>t.veterinarios=n),t.citasService.getCitas().subscribe(n=>t.citasExistentes=n))})()}generarHorasDisponibles(){const t=[];for(let a=9;a<18;a++)t.push(`${a.toString().padStart(2,"0")}:00`);this.horasDisponibles=t}verificarDisponibilidad(){var t=this;return(0,d.A)(function*(){if(t.nuevaCita.veterinarioId&&t.nuevaCita.fecha){const a=new Date(t.nuevaCita.fecha).setHours(0,0,0,0),n=t.citasExistentes.filter(o=>new Date(o.fecha).setHours(0,0,0,0)===a&&o.veterinarioId===t.nuevaCita.veterinarioId);t.horasDisponibles=t.horasDisponibles.filter(o=>{const c=parseInt(o.split(":")[0]);return!n.some(g=>new Date(g.fecha).getHours()===c)})}})()}guardarCita(){var t=this;return(0,d.A)(function*(){if(!t.validarCita())return;const a=yield t.authService.getUserId();if(!a)return;const[n]=t.nuevaCita.hora.split(":"),o=new Date(t.nuevaCita.fecha);o.setHours(parseInt(n),0,0,0);const c={mascotaId:t.nuevaCita.mascotaId,usuarioId:a,veterinarioId:t.nuevaCita.veterinarioId,fecha:o.toISOString(),motivo:t.nuevaCita.motivo,estado:"pendiente"};try{yield t.citasService.createCita(c),t.modalController.dismiss({success:!0})}catch(g){console.error("Error al crear la cita:",g)}})()}validarCita(){return!!(this.nuevaCita.veterinarioId&&this.nuevaCita.mascotaId&&this.nuevaCita.fecha&&this.nuevaCita.hora&&this.nuevaCita.motivo)}dismiss(){this.modalController.dismiss()}}return(i=l).\u0275fac=function(t){return new(t||i)(e.rXU(s.W3),e.rXU(D),e.rXU(I.i),e.rXU(v.W),e.rXU(h.u))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-nueva-cita-modal"]],decls:36,vars:11,consts:[["slot","end"],[3,"click"],["name","close"],[1,"ion-padding"],["position","stacked"],["name","veterinario",3,"ngModelChange","ionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","mascota",3,"ngModelChange","ngModel"],["name","fecha","presentation","date","locale","es-ES",3,"ngModelChange","ionChange","ngModel","min","max"],["name","hora",3,"ngModelChange","ngModel"],["name","motivo","rows","3","placeholder","Describe el motivo de la consulta",3,"ngModelChange","ngModel"],["expand","block",3,"click","disabled"],[3,"value"]],template:function(t,a){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Nueva Cita"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return a.dismiss()}),e.nrm(6,"ion-icon",2),e.k0s()()()(),e.j41(7,"ion-content",3)(8,"form")(9,"ion-item")(10,"ion-label",4),e.EFF(11,"Veterinario"),e.k0s(),e.j41(12,"ion-select",5),e.mxI("ngModelChange",function(o){return e.DH7(a.nuevaCita.veterinarioId,o)||(a.nuevaCita.veterinarioId=o),o}),e.bIt("ionChange",function(){return a.verificarDisponibilidad()}),e.DNE(13,k,2,3,"ion-select-option",6),e.k0s()(),e.j41(14,"ion-item")(15,"ion-label",4),e.EFF(16,"Mascota"),e.k0s(),e.j41(17,"ion-select",7),e.mxI("ngModelChange",function(o){return e.DH7(a.nuevaCita.mascotaId,o)||(a.nuevaCita.mascotaId=o),o}),e.DNE(18,j,2,3,"ion-select-option",6),e.k0s()(),e.j41(19,"ion-item")(20,"ion-label",4),e.EFF(21,"Fecha"),e.k0s(),e.j41(22,"ion-datetime",8),e.mxI("ngModelChange",function(o){return e.DH7(a.nuevaCita.fecha,o)||(a.nuevaCita.fecha=o),o}),e.bIt("ionChange",function(){return a.verificarDisponibilidad()}),e.k0s()(),e.j41(23,"ion-item")(24,"ion-label",4),e.EFF(25,"Hora"),e.k0s(),e.j41(26,"ion-select",9),e.mxI("ngModelChange",function(o){return e.DH7(a.nuevaCita.hora,o)||(a.nuevaCita.hora=o),o}),e.DNE(27,S,2,2,"ion-select-option",6),e.k0s()(),e.j41(28,"ion-item")(29,"ion-label",4),e.EFF(30,"Motivo de la consulta"),e.k0s(),e.j41(31,"ion-textarea",10),e.mxI("ngModelChange",function(o){return e.DH7(a.nuevaCita.motivo,o)||(a.nuevaCita.motivo=o),o}),e.k0s()()()(),e.j41(32,"ion-footer")(33,"ion-toolbar")(34,"ion-button",11),e.bIt("click",function(){return a.guardarCita()}),e.EFF(35," Agendar Cita "),e.k0s()()()),2&t&&(e.R7$(12),e.R50("ngModel",a.nuevaCita.veterinarioId),e.R7$(),e.Y8G("ngForOf",a.veterinarios),e.R7$(4),e.R50("ngModel",a.nuevaCita.mascotaId),e.R7$(),e.Y8G("ngForOf",a.mascotas),e.R7$(4),e.R50("ngModel",a.nuevaCita.fecha),e.Y8G("min",a.minDate)("max",a.maxDate.toISOString()),e.R7$(4),e.R50("ngModel",a.nuevaCita.hora),e.R7$(),e.Y8G("ngForOf",a.horasDisponibles),e.R7$(4),e.R50("ngModel",a.nuevaCita.motivo),e.R7$(3),e.Y8G("disabled",!a.validarCita()))},dependencies:[_.Sq,m.qT,m.BC,m.cb,m.vS,m.cV,s.Jm,s.QW,s.W9,s.A9,s.M0,s.eU,s.iq,s.uz,s.he,s.Nm,s.Ip,s.nc,s.BC,s.ai,s.Je,s.Gw]}),l})();function U(i,l){if(1&i&&(e.j41(0,"ion-select-option",11),e.EFF(1),e.k0s()),2&i){const r=l.$implicit;e.Y8G("value",r.id),e.R7$(),e.Lme(" ",r.nombre," - ",r.especie," ")}}function R(i,l){if(1&i&&(e.j41(0,"ion-select-option",11),e.EFF(1),e.k0s()),2&i){const r=l.$implicit;e.Y8G("value",r),e.R7$(),e.SpI(" ",r," ")}}let H=(()=>{var i;class l{constructor(t,a,n){this.modalController=t,this.citasService=a,this.mascotaService=n,this.mascotas=[],this.horasDisponibles=[],this.citasExistentes=[],this.minDate=(new Date).toISOString(),this.maxDate=new Date,this.editandoCita={mascotaId:"",fecha:"",hora:"",motivo:""},this.maxDate.setMonth(this.maxDate.getMonth()+3)}ngOnInit(){this.cargarDatos(),this.inicializarFormulario()}inicializarFormulario(){const t=new Date(this.cita.fecha);this.editandoCita={mascotaId:this.cita.mascotaId,fecha:this.cita.fecha,hora:`${t.getHours().toString().padStart(2,"0")}:00`,motivo:this.cita.motivo},this.generarHorasDisponibles()}cargarDatos(){var t=this;return(0,d.A)(function*(){t.cita.usuarioId&&t.mascotaService.obtenerMascotasPorUsuarioId(t.cita.usuarioId).subscribe(a=>t.mascotas=a),t.cita.usuarioId&&t.mascotaService.obtenerMascotasPorUsuarioId(t.cita.usuarioId).subscribe(a=>t.mascotas=a),t.citasService.getCitas().subscribe(a=>{t.citasExistentes=a.filter(n=>n.id!==t.cita.id)})})()}generarHorasDisponibles(){const t=[];for(let a=9;a<18;a++)t.push(`${a.toString().padStart(2,"0")}:00`);this.horasDisponibles=t,this.verificarDisponibilidad()}verificarDisponibilidad(){var t=this;return(0,d.A)(function*(){if(t.editandoCita.fecha){const a=new Date(t.editandoCita.fecha).setHours(0,0,0,0),n=t.citasExistentes.filter(c=>new Date(c.fecha).setHours(0,0,0,0)===a),o=[];for(let c=9;c<18;c++){const g=`${c.toString().padStart(2,"0")}:00`;(!n.some(q=>new Date(q.fecha).getHours()===c)||t.editandoCita.hora===g)&&o.push(g)}t.horasDisponibles=o}})()}guardarCambios(){var t=this;return(0,d.A)(function*(){if(!t.validarCita())return;const[a]=t.editandoCita.hora.split(":"),n=new Date(t.editandoCita.fecha);n.setHours(parseInt(a),0,0,0);const o={mascotaId:t.editandoCita.mascotaId,fecha:n.toISOString(),motivo:t.editandoCita.motivo};try{t.cita.id&&(yield t.citasService.updateCita(t.cita.id,o),t.modalController.dismiss({success:!0}))}catch(c){console.error("Error al actualizar la cita:",c)}})()}validarCita(){return!!(this.editandoCita.mascotaId&&this.editandoCita.fecha&&this.editandoCita.hora&&this.editandoCita.motivo)}dismiss(){this.modalController.dismiss()}}return(i=l).\u0275fac=function(t){return new(t||i)(e.rXU(s.W3),e.rXU(I.i),e.rXU(v.W))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-editar-cita-modal"]],inputs:{cita:"cita"},decls:31,vars:9,consts:[["slot","end"],[3,"click"],["name","close"],[1,"ion-padding"],["position","stacked"],["name","mascota",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["name","fecha","presentation","date","locale","es-ES",3,"ngModelChange","ionChange","ngModel","min","max"],["name","hora",3,"ngModelChange","ngModel"],["name","motivo","rows","3","placeholder","Describe el motivo de la consulta",3,"ngModelChange","ngModel"],["expand","block",3,"click","disabled"],[3,"value"]],template:function(t,a){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Editar Cita"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return a.dismiss()}),e.nrm(6,"ion-icon",2),e.k0s()()()(),e.j41(7,"ion-content",3)(8,"form")(9,"ion-item")(10,"ion-label",4),e.EFF(11,"Mascota"),e.k0s(),e.j41(12,"ion-select",5),e.mxI("ngModelChange",function(o){return e.DH7(a.editandoCita.mascotaId,o)||(a.editandoCita.mascotaId=o),o}),e.DNE(13,U,2,3,"ion-select-option",6),e.k0s()(),e.j41(14,"ion-item")(15,"ion-label",4),e.EFF(16,"Fecha"),e.k0s(),e.j41(17,"ion-datetime",7),e.mxI("ngModelChange",function(o){return e.DH7(a.editandoCita.fecha,o)||(a.editandoCita.fecha=o),o}),e.bIt("ionChange",function(){return a.verificarDisponibilidad()}),e.k0s()(),e.j41(18,"ion-item")(19,"ion-label",4),e.EFF(20,"Hora"),e.k0s(),e.j41(21,"ion-select",8),e.mxI("ngModelChange",function(o){return e.DH7(a.editandoCita.hora,o)||(a.editandoCita.hora=o),o}),e.DNE(22,R,2,2,"ion-select-option",6),e.k0s()(),e.j41(23,"ion-item")(24,"ion-label",4),e.EFF(25,"Motivo de la consulta"),e.k0s(),e.j41(26,"ion-textarea",9),e.mxI("ngModelChange",function(o){return e.DH7(a.editandoCita.motivo,o)||(a.editandoCita.motivo=o),o}),e.k0s()()()(),e.j41(27,"ion-footer")(28,"ion-toolbar")(29,"ion-button",10),e.bIt("click",function(){return a.guardarCambios()}),e.EFF(30," Guardar Cambios "),e.k0s()()()),2&t&&(e.R7$(12),e.R50("ngModel",a.editandoCita.mascotaId),e.R7$(),e.Y8G("ngForOf",a.mascotas),e.R7$(4),e.R50("ngModel",a.editandoCita.fecha),e.Y8G("min",a.minDate)("max",a.maxDate.toISOString()),e.R7$(4),e.R50("ngModel",a.editandoCita.hora),e.R7$(),e.Y8G("ngForOf",a.horasDisponibles),e.R7$(4),e.R50("ngModel",a.editandoCita.motivo),e.R7$(3),e.Y8G("disabled",!a.validarCita()))},dependencies:[_.Sq,m.qT,m.BC,m.cb,m.vS,m.cV,s.Jm,s.QW,s.W9,s.A9,s.M0,s.eU,s.iq,s.uz,s.he,s.Nm,s.Ip,s.nc,s.BC,s.ai,s.Je,s.Gw]}),l})();function N(i,l){if(1&i&&(e.j41(0,"h2",11),e.EFF(1),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.SpI(" Bienvenido, ",r.userName," ")}}function T(i,l){1&i&&(e.j41(0,"h2",11),e.nrm(1,"ion-skeleton-text",12),e.k0s()),2&i&&(e.R7$(),e.Y8G("animated",!0))}function P(i,l){if(1&i&&(e.j41(0,"ion-item")(1,"ion-label")(2,"h2"),e.EFF(3),e.nI1(4,"date"),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"p"),e.EFF(8),e.k0s()()()),2&i){let r;const t=l.$implicit,a=e.XpG(2);e.R7$(3),e.Lme("",e.i5U(4,4,t.fecha,"HH:mm")," - ",null==(r=a.getMascotaInfo(t.mascotaId))?null:r.nombre,""),e.R7$(3),e.SpI("Motivo: ",t.motivo,""),e.R7$(2),e.SpI("Estado: ",t.estado,"")}}function G(i,l){1&i&&(e.j41(0,"ion-text",18)(1,"p"),e.EFF(2,"No hay citas programadas para este d\xeda"),e.k0s()())}function $(i,l){if(1&i){const r=e.RV6();e.j41(0,"div",13)(1,"ion-datetime",14),e.bIt("ionChange",function(a){e.eBV(r);const n=e.XpG();return e.Njj(n.onDateChanged(a))}),e.k0s(),e.j41(2,"div",15)(3,"h2",13),e.EFF(4),e.nI1(5,"date"),e.k0s(),e.j41(6,"ion-list"),e.DNE(7,P,9,7,"ion-item",16),e.k0s(),e.DNE(8,G,3,0,"ion-text",17),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(),e.Y8G("value",r.selectedDate)("disabled",!1),e.R7$(3),e.SpI("Citas del d\xeda ",e.i5U(5,5,r.selectedDate,"dd/MM/yyyy"),""),e.R7$(3),e.Y8G("ngForOf",r.citasDelDia),e.R7$(),e.Y8G("ngIf",0===r.citasDelDia.length)}}function V(i,l){if(1&i){const r=e.RV6();e.j41(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label")(3,"h2"),e.EFF(4),e.nI1(5,"date"),e.k0s(),e.j41(6,"h3"),e.EFF(7),e.k0s(),e.j41(8,"p"),e.EFF(9),e.k0s(),e.j41(10,"p"),e.EFF(11),e.k0s()()(),e.j41(12,"ion-item-options",20)(13,"ion-item-option",21),e.bIt("click",function(){const a=e.eBV(r).$implicit,n=e.XpG(2);return e.Njj(n.editarCita(a))}),e.nrm(14,"ion-icon",22),e.k0s(),e.j41(15,"ion-item-option",23),e.bIt("click",function(){const a=e.eBV(r).$implicit,n=e.XpG(2);return e.Njj(n.eliminarCita(a))}),e.nrm(16,"ion-icon",24),e.k0s()()()}if(2&i){let r;const t=l.$implicit,a=e.XpG(2);e.R7$(4),e.SpI("Fecha: ",e.i5U(5,4,t.fecha,"dd/MM/yyyy HH:mm"),""),e.R7$(3),e.SpI("Mascota: ",null==(r=a.getMascotaInfo(t.mascotaId))?null:r.nombre,""),e.R7$(2),e.SpI("Motivo: ",t.motivo,""),e.R7$(2),e.SpI("Estado: ",t.estado,"")}}function A(i,l){1&i&&(e.j41(0,"ion-text",18)(1,"p"),e.EFF(2,"No tienes citas programadas"),e.k0s()())}function O(i,l){if(1&i){const r=e.RV6();e.j41(0,"ion-fab",25)(1,"ion-fab-button",1),e.bIt("click",function(){e.eBV(r);const a=e.XpG(2);return e.Njj(a.abrirModalNuevaCita())}),e.nrm(2,"ion-icon",26),e.k0s()()}}function Y(i,l){if(1&i&&(e.j41(0,"div")(1,"ion-list"),e.DNE(2,V,17,7,"ion-item-sliding",16),e.k0s(),e.DNE(3,A,3,0,"ion-text",17)(4,O,3,0,"ion-fab",19),e.k0s()),2&i){const r=e.XpG();e.R7$(2),e.Y8G("ngForOf",r.misCitas),e.R7$(),e.Y8G("ngIf",0===r.misCitas.length),e.R7$(),e.Y8G("ngIf","citas"===r.segmentValue)}}function w(i,l){if(1&i){const r=e.RV6();e.j41(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label")(3,"h2"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"p"),e.EFF(8),e.k0s()()(),e.j41(9,"ion-item-options",20)(10,"ion-item-option",21),e.bIt("click",function(){const a=e.eBV(r).$implicit,n=e.XpG(3);return e.Njj(n.abrirModalEdicion(a))}),e.nrm(11,"ion-icon",22),e.k0s(),e.j41(12,"ion-item-option",23),e.bIt("click",function(){const a=e.eBV(r).$implicit,n=e.XpG(3);return e.Njj(n.eliminarMascota(a))}),e.nrm(13,"ion-icon",24),e.k0s()()()}if(2&i){const r=l.$implicit;e.R7$(4),e.JRh(r.nombre),e.R7$(2),e.SpI("- ",r.especie,""),e.R7$(2),e.SpI("Edad: ",r.edad," a\xf1os")}}function X(i,l){if(1&i&&(e.j41(0,"div")(1,"ion-list"),e.DNE(2,w,14,3,"ion-item-sliding",16),e.k0s()()),2&i){const r=e.XpG(2);e.R7$(2),e.Y8G("ngForOf",r.mascotas)}}function x(i,l){1&i&&(e.j41(0,"ion-text",18)(1,"p"),e.EFF(2,"No tienes mascotas registradas"),e.k0s()())}function W(i,l){1&i&&(e.j41(0,"ion-fab",25)(1,"ion-fab-button",27),e.nrm(2,"ion-icon",26),e.k0s()())}function z(i,l){if(1&i&&(e.j41(0,"div"),e.DNE(1,X,3,1,"div",10)(2,x,3,0,"ion-text",17)(3,W,3,0,"ion-fab",19),e.k0s()),2&i){const r=e.XpG();e.R7$(),e.Y8G("ngIf",r.mascotas.length>0),e.R7$(),e.Y8G("ngIf",0===r.mascotas.length),e.R7$(),e.Y8G("ngIf","mascotas"===r.segmentValue)}}const B=[{path:"",component:(()=>{var i;class l{constructor(t,a,n,o,c,g,E){this.modalController=t,this.mascotaService=a,this.citasService=n,this.authService=o,this.alertController=c,this.veterinarioService=g,this.router=E,this.mascotas=[],this.userName="Usuario",this.segmentValue="mascotas",this.selectedDate=(new Date).toISOString(),this.misCitas=[],this.citasDelDia=[],this.veterinarios=[]}ngOnInit(){var t=this;return(0,d.A)(function*(){yield t.cargarDatosUsuario(),yield t.cargarDatos(),t.cargarMascotas(),t.cargarVeterinarios()})()}cargarVeterinarios(){this.veterinarioService.getVeterinarios().subscribe(t=>{this.veterinarios=t,console.log("Veterinarios cargados:",this.veterinarios)})}getVeterinarioInfo(t){const a=this.veterinarios.find(n=>n.id===t);return console.log("Buscando veterinario:",t,"Encontrado:",a),a}cargarDatos(){var t=this;return(0,d.A)(function*(){const a=yield t.authService.getUserId();a&&(t.cargarMascotas(),t.cargarCitas(a))})()}cargarDatosUsuario(){var t=this;return(0,d.A)(function*(){try{t.userName=yield t.authService.getUserName()}catch(a){console.error("Error al cargar el nombre del usuario:",a)}})()}cargarMascotas(){var t=this;return(0,d.A)(function*(){const a=yield t.authService.getUserId();a&&t.mascotaService.obtenerMascotasPorUsuarioId(a).subscribe(n=>{t.mascotas=n})})()}segmentChanged(t){this.segmentValue=t.detail.value}cargarCitas(t){var a=this;return(0,d.A)(function*(){a.citasService.getCitas().subscribe(n=>{a.misCitas=n.filter(o=>o.usuarioId===t).sort((o,c)=>new Date(o.fecha).getTime()-new Date(c.fecha).getTime()),a.actualizarCitasDelDia()})})()}onDateChanged(t){this.selectedDate=t.detail.value,this.actualizarCitasDelDia()}actualizarCitasDelDia(){const t=new Date(this.selectedDate).setHours(0,0,0,0);this.citasDelDia=this.misCitas.filter(a=>new Date(a.fecha).setHours(0,0,0,0)===t)}getMascotaInfo(t){return this.mascotas.find(a=>a.id===t)}eliminarCita(t){var a=this;return(0,d.A)(function*(){var o;yield(yield a.alertController.create({header:"Confirmar eliminaci\xf3n",message:"\xbfEst\xe1s seguro que deseas eliminar esta cita?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",handler:(o=(0,d.A)(function*(){if(t.id)try{yield a.citasService.deleteCita(t.id),yield(yield a.alertController.create({header:"\xc9xito",message:"La cita ha sido eliminada correctamente",buttons:["OK"]})).present()}catch(c){console.error("Error al eliminar la cita:",c),yield(yield a.alertController.create({header:"Error",message:"No se pudo eliminar la cita. Por favor, intenta nuevamente.",buttons:["OK"]})).present()}}),function(){return o.apply(this,arguments)})}]})).present()})()}abrirModalEdicion(t){var a=this;return(0,d.A)(function*(){const n=yield a.modalController.create({component:p,componentProps:{mascota:{...t}}});yield n.present();const{data:o}=yield n.onWillDismiss();o&&a.cargarMascotas()})()}eliminarMascota(t){var a=this;return(0,d.A)(function*(){var o;yield(yield a.alertController.create({header:"Confirmar eliminaci\xf3n",message:`\xbfEst\xe1s seguro que deseas eliminar a ${t.nombre}?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(o=(0,d.A)(function*(){try{t.id&&(yield a.mascotaService.eliminarMascota(t.id),console.log("Mascota eliminada exitosamente"),yield a.cargarMascotas(),yield(yield a.alertController.create({header:"\xc9xito",message:"La mascota ha sido eliminada correctamente",buttons:["OK"]})).present())}catch(c){console.error("Error al eliminar mascota:",c),yield(yield a.alertController.create({header:"Error",message:"No se pudo eliminar la mascota. Por favor, intenta nuevamente.",buttons:["OK"]})).present()}}),function(){return o.apply(this,arguments)})}]})).present()})()}abrirModalNuevaCita(){var t=this;return(0,d.A)(function*(){const a=yield t.modalController.create({component:y});yield a.present();const{data:n}=yield a.onWillDismiss();if(n&&n.success){const o=yield t.authService.getUserId();o&&t.cargarCitas(o),yield(yield t.alertController.create({header:"\xc9xito",message:"La cita ha sido agendada correctamente",buttons:["OK"]})).present()}})()}editarCita(t){var a=this;return(0,d.A)(function*(){const n=yield a.modalController.create({component:H,componentProps:{cita:{...t},veterinarios:a.veterinarios}});yield n.present();const{data:o}=yield n.onWillDismiss();if(o&&o.success){const c=yield a.authService.getUserId();c&&a.cargarCitas(c),yield(yield a.alertController.create({header:"\xc9xito",message:"La cita ha sido actualizada correctamente",buttons:["OK"]})).present()}})()}logout(){var t=this;return(0,d.A)(function*(){var n;yield(yield t.alertController.create({header:"Cerrar Sesi\xf3n",message:"\xbfEst\xe1s seguro que deseas cerrar sesi\xf3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"S\xed, cerrar sesi\xf3n",handler:(n=(0,d.A)(function*(){try{yield t.authService.logout(),t.router.navigate(["/login"])}catch(o){console.error("Error al cerrar sesi\xf3n:",o)}}),function(){return n.apply(this,arguments)})}]})).present()})()}}return(i=l).\u0275fac=function(t){return new(t||i)(e.rXU(s.W3),e.rXU(v.W),e.rXU(I.i),e.rXU(h.u),e.rXU(s.hG),e.rXU(D),e.rXU(f.Ix))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-user-home"]],decls:24,vars:6,consts:[["slot","end"],[3,"click"],["name","log-out-outline","color","danger"],[1,"welcome-container"],["class","welcome-message",4,"ngIf"],[3,"ngModelChange","ionChange","ngModel"],["value","calendario"],["value","citas"],["value","mascotas"],["class","ion-padding",4,"ngIf"],[4,"ngIf"],[1,"welcome-message"],[2,"width","60%",3,"animated"],[1,"ion-padding"],["presentation","date","locale","es-ES",3,"ionChange","value","disabled"],[1,"citas-dia"],[4,"ngFor","ngForOf"],["color","medium","class","ion-text-center",4,"ngIf"],["color","medium",1,"ion-text-center"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],["side","end"],["color","primary",3,"click"],["slot","icon-only","name","create-outline"],["color","danger",3,"click"],["slot","icon-only","name","trash-outline"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],["routerLink","/agregar-mascota"]],template:function(t,a){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"V E T P L A N"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return a.logout()}),e.nrm(6,"ion-icon",2),e.k0s()()()(),e.j41(7,"ion-content")(8,"div",3),e.DNE(9,N,2,1,"h2",4)(10,T,2,1,"h2",4),e.k0s(),e.j41(11,"ion-segment",5),e.mxI("ngModelChange",function(o){return e.DH7(a.segmentValue,o)||(a.segmentValue=o),o}),e.bIt("ionChange",function(o){return a.segmentChanged(o)}),e.j41(12,"ion-segment-button",6)(13,"ion-label"),e.EFF(14,"Calendario"),e.k0s()(),e.j41(15,"ion-segment-button",7)(16,"ion-label"),e.EFF(17,"Mis Citas"),e.k0s()(),e.j41(18,"ion-segment-button",8)(19,"ion-label"),e.EFF(20,"Mis Mascotas"),e.k0s()()(),e.DNE(21,$,9,8,"div",9)(22,Y,5,3,"div",10)(23,z,4,3,"div",10),e.k0s()),2&t&&(e.R7$(9),e.Y8G("ngIf","Usuario"!==a.userName),e.R7$(),e.Y8G("ngIf","Usuario"===a.userName),e.R7$(),e.R50("ngModel",a.segmentValue),e.R7$(10),e.Y8G("ngIf","calendario"===a.segmentValue),e.R7$(),e.Y8G("ngIf","citas"===a.segmentValue),e.R7$(),e.Y8G("ngIf","mascotas"===a.segmentValue))},dependencies:[_.Sq,_.bT,m.BC,m.vS,s.Jm,s.QW,s.W9,s.A9,s.Q8,s.YW,s.eU,s.iq,s.uz,s.LU,s.CE,s.A7,s.he,s.nf,s.Gp,s.eP,s.ds,s.IO,s.BC,s.ai,s.Je,s.N7,f.Wk,_.vh],styles:[".welcome-container[_ngcontent-%COMP%]{padding:16px;margin-bottom:16px}.welcome-message[_ngcontent-%COMP%]{font-size:24px;font-weight:500;color:var(--ion-color-primary);margin:0;padding:16px 0}"]}),l})()},{path:"agregar-mascota",loadChildren:()=>u.e(4631).then(u.bind(u,4631)).then(i=>i.AgregarMascotaPageModule)}];let L=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[f.iI.forChild(B),f.iI]}),l})(),K=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[_.MD,m.YN,s.bv]}),l})(),J=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[_.MD,m.YN,s.bv]}),l})(),Q=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[_.MD,m.YN,s.bv]}),l})(),Z=(()=>{var i;class l{}return(i=l).\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.$C({type:i}),i.\u0275inj=e.G2t({imports:[_.MD,m.YN,s.bv,L,K,J,Q]}),l})()},8860:(F,M,u)=>{u.d(M,{W:()=>f});var _=u(467),m=u(4438),s=u(8079);let f=(()=>{var d;class e{constructor(h){this.firestore=h,this.mascotasCollection=this.firestore.collection("mascotas")}crearMascota(h){const p=this.firestore.createId();return this.mascotasCollection.doc(p).set({...h,id:p})}obtenerMascotasPorUsuarioId(h){return this.firestore.collection("mascotas",p=>p.where("usuarioId","==",h)).valueChanges({idField:"id"})}obtenerTodasLasMascotas(){return this.mascotasCollection.valueChanges({idField:"id"})}obtenerMascotaPorId(h){return this.mascotasCollection.doc(h).valueChanges()}actualizarMascota(h,p){return this.mascotasCollection.doc(h).update(p)}eliminarMascota(h){var p=this;return(0,_.A)(function*(){try{const C=p.mascotasCollection.doc(h),b=yield C.get().toPromise();return b&&b.exists?(yield C.delete(),console.log(`Mascota con ID ${h} eliminada correctamente`),Promise.resolve()):(console.error(`No se encontr\xf3 la mascota con ID ${h}`),Promise.reject(new Error("Documento no encontrado")))}catch(C){return console.error("Error al eliminar la mascota:",C),Promise.reject(C)}})()}}return(d=e).\u0275fac=function(h){return new(h||d)(m.KVO(s.Qe))},d.\u0275prov=m.jDH({token:d,factory:d.\u0275fac,providedIn:"root"}),e})()}}]);