"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5675],{5675:(G,f,c)=>{c.r(f),c.d(f,{AdminHomePageModule:()=>$});var p=c(177),d=c(9417),n=c(4742),_=c(4964),m=c(467),e=c(4438),v=c(4796);function C(o,l){if(1&o&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.SpI(" ",r.nombreError," ")}}function b(o,l){if(1&o&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.SpI(" ",r.emailError," ")}}function F(o,l){if(1&o&&(e.j41(0,"div",11),e.EFF(1),e.k0s()),2&o){const r=e.XpG();e.R7$(),e.SpI(" ",r.passwordError," ")}}let E=(()=>{var o;class l{constructor(t,i,s){this.modalController=t,this.authService=i,this.alertController=s,this.nombre="",this.email="",this.password="",this.nombreError="",this.emailError="",this.passwordError=""}validateNombre(){this.nombreError=this.nombre.trim()?"":"El nombre es requerido"}validateEmail(){this.emailError=this.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)?"":"Ingrese un correo v\xe1lido":"El correo es requerido"}validatePassword(){this.passwordError=this.password?this.password.length<6?"La contrase\xf1a debe tener al menos 6 caracteres":"":"La contrase\xf1a es requerida"}isFormValid(){return!this.nombreError&&!this.emailError&&!this.passwordError&&""!==this.nombre.trim()&&""!==this.email&&""!==this.password}registrarVeterinario(){var t=this;return(0,m.A)(function*(){try{yield t.authService.register(t.email,t.password,t.nombre,"veterinario"),console.log("Veterinario registrado:",{email:t.email,nombre:t.nombre,rol:"veterinario"}),yield(yield t.alertController.create({header:"\xc9xito",message:"Veterinario registrado correctamente",buttons:["OK"]})).present(),t.modalController.dismiss({success:!0})}catch(i){console.error("Error al registrar veterinario:",i),yield(yield t.alertController.create({header:"Error",message:"Error al registrar el veterinario. Por favor, intente nuevamente.",buttons:["OK"]})).present()}})()}dismiss(){this.modalController.dismiss()}}return(o=l).\u0275fac=function(t){return new(t||o)(e.rXU(n.W3),e.rXU(v.u),e.rXU(n.hG))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-registrar-veterinario-modal"]],decls:29,vars:7,consts:[["slot","end"],[3,"click"],["name","close-outline"],[1,"ion-padding"],[1,"form-group"],["position","floating"],["name","nombre",3,"ngModelChange","ionInput","ngModel"],["class","error-message",4,"ngIf"],["name","email","type","email",3,"ngModelChange","ionInput","ngModel"],["name","password","type","password",3,"ngModelChange","ionInput","ngModel"],["expand","block",1,"ion-margin-top",3,"click","disabled"],[1,"error-message"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Registrar Veterinario"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return i.dismiss()}),e.nrm(6,"ion-icon",2),e.k0s()()()(),e.j41(7,"ion-content",3)(8,"form")(9,"div",4)(10,"ion-item")(11,"ion-label",5),e.EFF(12,"Nombre"),e.k0s(),e.j41(13,"ion-input",6),e.mxI("ngModelChange",function(a){return e.DH7(i.nombre,a)||(i.nombre=a),a}),e.bIt("ionInput",function(){return i.validateNombre()}),e.k0s()(),e.DNE(14,C,2,1,"div",7),e.k0s(),e.j41(15,"div",4)(16,"ion-item")(17,"ion-label",5),e.EFF(18,"Correo"),e.k0s(),e.j41(19,"ion-input",8),e.mxI("ngModelChange",function(a){return e.DH7(i.email,a)||(i.email=a),a}),e.bIt("ionInput",function(){return i.validateEmail()}),e.k0s()(),e.DNE(20,b,2,1,"div",7),e.k0s(),e.j41(21,"div",4)(22,"ion-item")(23,"ion-label",5),e.EFF(24,"Contrase\xf1a"),e.k0s(),e.j41(25,"ion-input",9),e.mxI("ngModelChange",function(a){return e.DH7(i.password,a)||(i.password=a),a}),e.bIt("ionInput",function(){return i.validatePassword()}),e.k0s()(),e.DNE(26,F,2,1,"div",7),e.k0s(),e.j41(27,"ion-button",10),e.bIt("click",function(){return i.registrarVeterinario()}),e.EFF(28," Registrar Veterinario "),e.k0s()()()),2&t&&(e.R7$(13),e.R50("ngModel",i.nombre),e.R7$(),e.Y8G("ngIf",i.nombreError),e.R7$(5),e.R50("ngModel",i.email),e.R7$(),e.Y8G("ngIf",i.emailError),e.R7$(5),e.R50("ngModel",i.password),e.R7$(),e.Y8G("ngIf",i.passwordError),e.R7$(),e.Y8G("disabled",!i.isFormValid()))},dependencies:[p.bT,d.qT,d.BC,d.cb,d.vS,d.cV,n.Jm,n.QW,n.W9,n.eU,n.iq,n.$w,n.uz,n.he,n.BC,n.ai,n.Gw],styles:[".error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:.8em;margin:5px 0 0 16px}.form-group[_ngcontent-%COMP%]{margin-bottom:16px}"]}),l})();var R=c(7468),M=c(4035);function k(o,l){1&o&&(e.j41(0,"div",13),e.nrm(1,"ion-spinner"),e.j41(2,"p"),e.EFF(3,"Cargando veterinarios..."),e.k0s()())}function j(o,l){if(1&o){const r=e.RV6();e.j41(0,"ion-item-sliding")(1,"ion-item")(2,"ion-label")(3,"h2"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s(),e.j41(7,"p")(8,"ion-text",15),e.EFF(9),e.EFF(10),e.k0s()()(),e.j41(11,"ion-badge",16),e.EFF(12,"Activo"),e.k0s()(),e.j41(13,"ion-item-options",17)(14,"ion-item-option",18),e.bIt("click",function(){const i=e.eBV(r).$implicit,s=e.XpG(3);return e.Njj(s.desactivarVeterinario(i))}),e.nrm(15,"ion-icon",19),e.k0s()()()}if(2&o){const r=l.$implicit,t=e.XpG(3);e.R7$(4),e.JRh(r.name),e.R7$(2),e.JRh(r.email),e.R7$(3),e.SpI(" Citas: ",t.getCitasVeterinario(r.uid)," | "),e.R7$(),e.SpI(" Pacientes: ",t.getMascotasVeterinario(r.uid)," ")}}function V(o,l){if(1&o&&(e.j41(0,"ion-list"),e.DNE(1,j,16,4,"ion-item-sliding",14),e.k0s()),2&o){const r=e.XpG(2);e.R7$(),e.Y8G("ngForOf",r.veterinarios)}}function I(o,l){1&o&&(e.j41(0,"ion-text",20)(1,"p"),e.EFF(2,"No hay veterinarios registrados"),e.k0s()())}function P(o,l){if(1&o){const r=e.RV6();e.j41(0,"div"),e.DNE(1,k,4,0,"div",9)(2,V,2,1,"ion-list",7)(3,I,3,0,"ion-text",10),e.j41(4,"ion-fab",11)(5,"ion-fab-button",1),e.bIt("click",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.presentRegistroVeterinario())}),e.nrm(6,"ion-icon",12),e.k0s()()()}if(2&o){const r=e.XpG();e.R7$(),e.Y8G("ngIf",r.loading),e.R7$(),e.Y8G("ngIf",!r.loading),e.R7$(),e.Y8G("ngIf",!r.loading&&0===r.veterinarios.length)}}function y(o,l){1&o&&(e.j41(0,"div",31),e.nrm(1,"ion-spinner"),e.j41(2,"p"),e.EFF(3,"Cargando estad\xedsticas..."),e.k0s()())}function A(o,l){if(1&o&&(e.j41(0,"div",21),e.DNE(1,y,4,0,"div",22),e.j41(2,"ion-card")(3,"ion-card-header")(4,"ion-card-title"),e.EFF(5,"Resumen General"),e.k0s()(),e.j41(6,"ion-card-content")(7,"ion-grid")(8,"ion-row")(9,"ion-col",23)(10,"div",24),e.nrm(11,"ion-icon",25),e.j41(12,"h3"),e.EFF(13),e.k0s(),e.j41(14,"p"),e.EFF(15,"Usuarios"),e.k0s()()(),e.j41(16,"ion-col",23)(17,"div",24),e.nrm(18,"ion-icon",26),e.j41(19,"h3"),e.EFF(20),e.k0s(),e.j41(21,"p"),e.EFF(22,"Veterinarios"),e.k0s()()()(),e.j41(23,"ion-row")(24,"ion-col",23)(25,"div",24),e.nrm(26,"ion-icon",27),e.j41(27,"h3"),e.EFF(28),e.k0s(),e.j41(29,"p"),e.EFF(30,"Mascotas"),e.k0s()()(),e.j41(31,"ion-col",23)(32,"div",24),e.nrm(33,"ion-icon",28),e.j41(34,"h3"),e.EFF(35),e.k0s(),e.j41(36,"p"),e.EFF(37,"Citas Totales"),e.k0s()()()()()()(),e.j41(38,"ion-card")(39,"ion-card-header")(40,"ion-card-title"),e.EFF(41,"Estado de Citas"),e.k0s()(),e.j41(42,"ion-card-content")(43,"ion-list")(44,"ion-item")(45,"ion-label"),e.EFF(46,"Pendientes"),e.k0s(),e.j41(47,"ion-badge",29),e.EFF(48),e.k0s()(),e.j41(49,"ion-item")(50,"ion-label"),e.EFF(51,"Completadas"),e.k0s(),e.j41(52,"ion-badge",16),e.EFF(53),e.k0s()(),e.j41(54,"ion-item")(55,"ion-label"),e.EFF(56,"Canceladas"),e.k0s(),e.j41(57,"ion-badge",30),e.EFF(58),e.k0s()()()()()()),2&o){const r=e.XpG();e.R7$(),e.Y8G("ngIf",r.loading),e.R7$(12),e.JRh(r.estadisticas.totalUsuarios),e.R7$(7),e.JRh(r.estadisticas.veterinariosActivos),e.R7$(8),e.JRh(r.estadisticas.totalMascotas),e.R7$(7),e.JRh(r.estadisticas.totalCitas),e.R7$(13),e.JRh(r.estadisticas.citasPendientes),e.R7$(5),e.JRh(r.estadisticas.citasCompletadas),e.R7$(5),e.JRh(r.estadisticas.citasCanceladas)}}function x(o,l){if(1&o){const r=e.RV6();e.j41(0,"div",21)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.EFF(4,"Configuraci\xf3n del Sistema"),e.k0s()(),e.j41(5,"ion-card-content")(6,"ion-list")(7,"ion-item"),e.nrm(8,"ion-icon",32),e.j41(9,"ion-label")(10,"h2"),e.EFF(11,"Horario de Atenci\xf3n"),e.k0s(),e.j41(12,"p"),e.EFF(13,"09:00 - 18:00"),e.k0s()()(),e.j41(14,"ion-item"),e.nrm(15,"ion-icon",33),e.j41(16,"ion-label")(17,"h2"),e.EFF(18,"\xdaltimo Respaldo"),e.k0s(),e.j41(19,"p"),e.EFF(20),e.nI1(21,"date"),e.k0s()(),e.j41(22,"ion-button",34),e.bIt("click",function(){e.eBV(r);const i=e.XpG();return e.Njj(i.generarRespaldo())}),e.EFF(23," Respaldar "),e.k0s()()()()()()}if(2&o){const r=e.XpG();e.R7$(20),e.JRh(e.i5U(21,1,r.ultimoRespaldo,"dd/MM/yyyy HH:mm"))}}const H=[{path:"",component:(()=>{var o;class l{constructor(t,i,s,a,u,g){this.authService=t,this.firestoreService=i,this.modalController=s,this.alertController=a,this.changeDetectorRef=u,this.router=g,this.segmentValue="veterinarios",this.veterinarios=[],this.usuarios=[],this.mascotas=[],this.citas=[],this.estadisticas={totalUsuarios:0,totalMascotas:0,totalCitas:0,veterinariosActivos:0,citasPendientes:0,citasCompletadas:0,citasCanceladas:0},this.ultimoRespaldo=new Date,this.loading=!0}ngOnInit(){this.cargarDatos()}cargarDatos(){var t=this;return(0,m.A)(function*(){console.log("Iniciando carga de datos"),t.loading=!0,t.firestoreService.getUsersByRole("veterinario").subscribe({next:i=>{console.log("Veterinarios encontrados:",i),t.veterinarios=i,t.estadisticas.veterinariosActivos=i.length,t.loading=!1,t.changeDetectorRef.detectChanges()},error:i=>console.error("Error cargando veterinarios:",i)}),t.firestoreService.getUsersByRole("usuario").subscribe({next:i=>{console.log("Usuarios encontrados:",i),t.usuarios=i,t.estadisticas.totalUsuarios=i.length,t.loading=!1,t.changeDetectorRef.detectChanges()},error:i=>console.error("Error cargando usuarios:",i)}),t.firestoreService.getAllMascotas().subscribe({next:i=>{console.log("Mascotas encontradas:",i),t.mascotas=i,t.estadisticas.totalMascotas=i.length,t.loading=!1,t.changeDetectorRef.detectChanges()},error:i=>console.error("Error cargando mascotas:",i)}),t.firestoreService.getAllCitas().subscribe({next:i=>{console.log("Citas encontradas:",i),t.citas=i,t.estadisticas.totalCitas=i.length,t.estadisticas.citasPendientes=i.filter(s=>"pendiente"===s.estado).length,t.estadisticas.citasCompletadas=i.filter(s=>"completada"===s.estado).length,t.estadisticas.citasCanceladas=i.filter(s=>"cancelada"===s.estado).length,t.loading=!1,t.changeDetectorRef.detectChanges()},error:i=>console.error("Error cargando citas:",i)})})()}actualizarEstadisticas(){this.estadisticas={totalUsuarios:this.usuarios.length,totalMascotas:this.mascotas.length,totalCitas:this.citas.length,veterinariosActivos:this.veterinarios.length,citasPendientes:this.citas.filter(t=>"pendiente"===t.estado).length,citasCompletadas:this.citas.filter(t=>"completada"===t.estado).length,citasCanceladas:this.citas.filter(t=>"cancelada"===t.estado).length}}cargarVeterinarios(){this.firestoreService.getDocumentsByQuery("users",t=>t.where("rol","==","veterinario")).subscribe(t=>{this.veterinarios=t,console.log("Veterinarios cargados:",t)})}cargarEstadisticas(){const t=this.firestoreService.getDocumentsByQuery("users",a=>a.where("rol","==","usuario")),i=this.firestoreService.getDocumentsByQuery("mascotas"),s=this.firestoreService.getDocumentsByQuery("citas");(0,R.p)({usuarios:t,mascotas:i,citas:s}).subscribe(({usuarios:a,mascotas:u,citas:g})=>{this.usuarios=a,this.mascotas=u,this.citas=g,this.estadisticas.totalUsuarios=a.length,this.estadisticas.totalMascotas=u.length,this.estadisticas.totalCitas=g.length,this.estadisticas.citasPendientes=g.filter(h=>"pendiente"===h.estado).length,this.estadisticas.citasCompletadas=g.filter(h=>"completada"===h.estado).length,this.estadisticas.citasCanceladas=g.filter(h=>"cancelada"===h.estado).length})}getCitasVeterinario(t){console.log("Buscando citas para veterinario:",t);const i=this.citas.filter(s=>s.veterinarioId===t);return console.log("Citas encontradas:",i),i.length}getMascotasVeterinario(t){console.log("Buscando mascotas para veterinario:",t);const i=this.citas.filter(a=>a.veterinarioId===t),s=[...new Set(i.map(a=>a.mascotaId))];return console.log("Mascotas \xfanicas encontradas:",s),s.length}segmentChanged(t){this.segmentValue=t.detail.value}presentRegistroVeterinario(){var t=this;return(0,m.A)(function*(){const i=yield t.modalController.create({component:E});return i.onDidDismiss().then(s=>{var a;null!==(a=s.data)&&void 0!==a&&a.success&&t.cargarDatos()}),yield i.present()})()}desactivarVeterinario(t){var i=this;return(0,m.A)(function*(){var a;yield(yield i.alertController.create({header:"Confirmar",message:`\xbfEst\xe1 seguro que desea desactivar a ${t.nombre}?`,buttons:[{text:"Cancelar",role:"cancel"},{text:"Desactivar",handler:(a=(0,m.A)(function*(){try{yield i.firestoreService.updateDoc("users",t.id,{activo:!1}),i.cargarDatos(),yield(yield i.alertController.create({header:"\xc9xito",message:"Veterinario desactivado correctamente",buttons:["OK"]})).present()}catch{yield(yield i.alertController.create({header:"Error",message:"No se pudo desactivar el veterinario",buttons:["OK"]})).present()}}),function(){return a.apply(this,arguments)})}]})).present()})()}generarRespaldo(){var t=this;return(0,m.A)(function*(){t.ultimoRespaldo=new Date})()}logout(){var t=this;return(0,m.A)(function*(){var s;yield(yield t.alertController.create({header:"Cerrar Sesi\xf3n",message:"\xbfEst\xe1s seguro que deseas cerrar sesi\xf3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"S\xed, cerrar sesi\xf3n",handler:(s=(0,m.A)(function*(){try{yield t.authService.logout(),t.router.navigate(["/login"])}catch(a){console.error("Error al cerrar sesi\xf3n:",a)}}),function(){return s.apply(this,arguments)})}]})).present()})()}}return(o=l).\u0275fac=function(t){return new(t||o)(e.rXU(v.u),e.rXU(M.B),e.rXU(n.W3),e.rXU(n.hG),e.rXU(e.gRc),e.rXU(_.Ix))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-admin-home"]],decls:21,vars:4,consts:[["slot","end"],[3,"click"],["name","log-out-outline","color","danger"],[3,"ngModelChange","ionChange","ngModel"],["value","veterinarios"],["value","estadisticas"],["value","sistema"],[4,"ngIf"],["class","ion-padding",4,"ngIf"],["class","ion-text-center ion-padding",4,"ngIf"],["color","medium","class","ion-text-center ion-padding",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],[1,"ion-text-center","ion-padding"],[4,"ngFor","ngForOf"],["color","medium"],["slot","end","color","success"],["side","end"],["color","danger",3,"click"],["slot","icon-only","name","ban"],["color","medium",1,"ion-text-center","ion-padding"],[1,"ion-padding"],["class","ion-text-center",4,"ngIf"],["size","6"],[1,"stat-box"],["name","people"],["name","medical"],["name","paw"],["name","calendar"],["slot","end","color","warning"],["slot","end","color","danger"],[1,"ion-text-center"],["name","time-outline","slot","start"],["name","cloud-upload-outline","slot","start"],["slot","end",3,"click"]],template:function(t,i){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Panel de Administraci\xf3n"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return i.logout()}),e.nrm(6,"ion-icon",2),e.k0s()()()(),e.j41(7,"ion-content")(8,"ion-segment",3),e.mxI("ngModelChange",function(a){return e.DH7(i.segmentValue,a)||(i.segmentValue=a),a}),e.bIt("ionChange",function(a){return i.segmentChanged(a)}),e.j41(9,"ion-segment-button",4)(10,"ion-label"),e.EFF(11,"Gesti\xf3n Veterinarios"),e.k0s()(),e.j41(12,"ion-segment-button",5)(13,"ion-label"),e.EFF(14,"Estad\xedsticas"),e.k0s()(),e.j41(15,"ion-segment-button",6)(16,"ion-label"),e.EFF(17,"Sistema"),e.k0s()()(),e.DNE(18,P,7,3,"div",7)(19,A,59,8,"div",8)(20,x,24,4,"div",8),e.k0s()),2&t&&(e.R7$(8),e.R50("ngModel",i.segmentValue),e.R7$(10),e.Y8G("ngIf","veterinarios"===i.segmentValue),e.R7$(),e.Y8G("ngIf","estadisticas"===i.segmentValue),e.R7$(),e.Y8G("ngIf","sistema"===i.segmentValue))},dependencies:[p.Sq,p.bT,d.BC,d.vS,n.In,n.Jm,n.QW,n.b_,n.I9,n.ME,n.tN,n.hU,n.W9,n.Q8,n.YW,n.lO,n.eU,n.iq,n.uz,n.LU,n.CE,n.A7,n.he,n.nf,n.ln,n.Gp,n.eP,n.w2,n.IO,n.BC,n.ai,n.Je,p.vh],styles:[".stat-box[_ngcontent-%COMP%]{text-align:center;padding:16px;border-radius:8px;background:var(--ion-color-light);margin:8px}.stat-box[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:2em;color:var(--ion-color-primary)}.stat-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:8px 0;font-size:1.8em;font-weight:700;color:var(--ion-color-dark)}.stat-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--ion-color-medium)}ion-card[_ngcontent-%COMP%]{margin:16px;border-radius:12px;box-shadow:0 4px 8px #0000001a}ion-card-header[_ngcontent-%COMP%]{background:var(--ion-color-light)}ion-card-title[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700}"]}),l})()}];let D=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[_.iI.forChild(H),_.iI]}),l})(),$=(()=>{var o;class l{}return(o=l).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.$C({type:o}),o.\u0275inj=e.G2t({imports:[p.MD,d.YN,n.bv,D]}),l})()}}]);